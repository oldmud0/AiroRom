% Copyright (c) 2015 Benito Palacios Sánchez - All Rights Reserved.
% Esta obra está licenciada bajo la Licencia Creative Commons Atribución 4.0
% Internacional. Para ver una copia de esta licencia, visita
% http://creativecommons.org/licenses/by/4.0/.

\chapter{Resultados y recomendaciones}
% Resumir cada fallo / seguridad y añadir recomendación
A los largo de la memoria se han analizado una serie de juegos y sus algoritmos.
En esta sección se resumirán los más importantes y se propondrán mejoras en algunos casos.

\section{Seguridad sobre ficheros}
Los capítulos~\ref{sec:translations} y~\ref{sec:copyright} muestran los procedimientos de seguridad aplicados sobre ficheros para evitar su modificación y distribución.
A continuación, se enumeran los algoritmos por tipo de formato y se proponen soluciones para mejorar.

Comenzando por el acceso a ficheros, se ha observado dos tipos de protecciones.
La primera consiste en comprimir todos los archivos en uno, con un formato propietario.
De esta forma, utilizando programas genéricos de exploración de juegos no se pueden extraer los recursos.
Esto se ha visto implementando en el juego \textit{El Profesor Layton y la Llamada del Espectro}\footnote{\url{https://github.com/pleonex/airorom/wiki/Professor-Layton-and-The-Last-Specter}} y \textit{Guitar Hero: On Tours} (sección~\ref{sec:cr-guitarhero}).
En este caso, al utilizar la implementación de \texttt{zlib} para comprimir los datos, el algoritmo visto en ensamblador ocupaba 1900 líneas de código y hacía inviable su investigación.
La segunda técnica consiste en ofuscar el nombre y clasificación de los ficheros como se vio en \textit{Pokémon Blanco y Negro} (sección~\ref{sec:tr-pok-black}).

En cuanto a archivos con contenido de texto, se ha observado que el algoritmo común es realizar un cifrado sobre cada carácter mediante una clave que cambia (juegos de \textit{Pokémon}~\ref{sec:tr-pok}).
Esto provee de un buen mecanismo a nivel de eficiencia y ofuscación, requiriendo conocimientos de depuración para encontrar la clave.
El principal problema es usar la operación \texttt{XOR} con una clave estática en un fichero que tiene varios bytes nulos seguidos, ya que se estaría guardando la contraseña en texto plano dentro del fichero cifrado (caso de \textit{Pokémon Perla} en la tabla de contenidos~\ref{sec:tr-pok-pearl-text} y \textit{Ninokuni}~\ref{sec:tr-nino-text}).
La solución es usar una clave variable, por ejemplo como se hace en los juegos de Pokémon, sumando una constante a esta.

Además, usar una codificación no estándar para los caracteres dificulta la depuración, ya que no se puede encontrar texto ni en archivo binario del juego ni en la memoria RAM.
En este caso, para evitar poder usar técnicas de búsqueda diferencia (programa \textit{RelativeSearch}), se deben desordenar los caracteres mezclando en un mismo rango símbolos y letras.
Finalmente, para evitar que la nueva codificación se pueda obtener a través de la fuente, se debería cifrar este fichero también.

Respecto a las imágenes se encontró en \textit{Pokémon Perla y Diamante} un cifrado basado en la operación \texttt{XOR} con una clave dinámica (sección~\ref{sec:tr-pok-pearl-img}).
A pesar de cifrar un archivo es un buen método para proteger su contenido, en el caso de archivos multimedia debido a la complejidad de implementación para tratar estos contenidos, es mejor crear un nuevo formato.
De esta forma, si se hubiese utilizado otra codificación para los píxeles como representar un color en otro espacio o usando un número variable de bits, se hubiese necesitado crear nuevos programas para procesarlos.
Esta tarea es más compleja que realizar un bucle que descifre.

Finalmente, tras analizar los archivos con contenido de con derechos de autor como libros digitales (sección~\ref{sec:cr-ebook}), música (sección~\ref{sec:cr-ost}) y vídeos (sección~\ref{sec:cr-video}), no se encontraron mecanismos específico de protección.
A parte de usar codificaciones propietarias como en el caso del sonido \texttt{SADL} (sección~\ref{sec:cr-level5}) y vídeos de \acl{NDS}, los ficheros no estaban cifrados, ni incluían mecanismos de integridad.
Estos podrían cifrarse y ofuscarse usando las técnicas anteriormente descritas.

\section{Seguridad en comunicaciones}
Los protocolos de comunicación y seguridad implementada sobe los archivos descargados se analizó en el capítulo~\ref{sec:multiplayer}.

Respecto al protocolo de Nintendo para juegos en línea en \acl{NDS} (sección~\ref{sec:mp-nintendo-server}), ofrece mecanismos de autenticación usando \ac{CHAP} y cifrando la comunicación en \texttt{HTTPS}.
Sin embargo, una mala configuración de los servidores permitía que cambiando la \texttt{URL} de acceso en el juego, se pudiese usar \texttt{HTTP}, quitando la capa de cifrado.
En cuanto al acceso a los servidores de contenido descargable, estos tenían cerrado el puerto 80, bloqueando un acceso no cifrado.
Sin embargo, la forma de autenticación es mediante una contraseña incluida en texto plano en el juego (mecanismo~\ac{PAP}).
Los ficheros descargados de estos servidores, en el caso de \textit{Ninokuni} (sección~\ref{sec:mp-dlc-nino}) estaban cifrados mediante \texttt{RC4} e incluían integridad con \texttt{CRC32}.
No pasaba lo mismo con \textit{100 Classic Books Collection} (sección~\ref{sec:mp-dlc-books}) donde no se aplicaba ninguna protección al descargar libros digitales.

Se analizaron también dos juegos de plataformas móviles.
En \textit{Preguntados} (sección~\ref{sec:mp-mp-preg}) se comprobó que al no usar un protocolo seguro de comunicación, esta podía ser interceptada mediante una configuración \textit{man-in-the-middle}, obteniendo las respuestas correctas a las preguntadas planteadas en el juego.
En dicho apartado se proponía tanto cifrar la comunicación como cambiar el diseño del protocolo para no enviar las soluciones al cliente.
En el caso de \textit{Duet} (sección~\ref{sec:mp-dlc-duet}), el contenido descargable de pago se podía activar manualmente cambiando un valor de una base de datos.
Cifrando la base de datos o inclus,o comprobando que el usuario había realizado dicha compra con un servidor externo, se podría evitar.

Finalmente, se estudió el caso de transmisión de código ejecutable en las demos para \acl{NDS} (sección~\ref{sec:mp-sign}).
El problema se solucionaba firmando digitalmente el archivo con el código principal durante el envío, y realizando el algoritmo \texttt{HMAC} sobre los archivos secundarios de código.
Esta configuración evitaba ejecutar código alterado durante un ataque de \textit{man-in-the-middle}.
Sin embargo, si se modificaba el juego de original, en la segunda consola se podía ejecutar código alterado también.
Esto se podría evitar firmando digitalmente el binario principal durante la compilación del juego, en lugar de solo durante el envío inalámbrico.
De esta forma se evitaría poder ejecutar código no autorizado\footnote{Esto se realiza en la consola \acl{DSi}.}.
